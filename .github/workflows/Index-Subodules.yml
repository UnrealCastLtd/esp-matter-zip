name: List All Submodules

on:
  workflow_dispatch:

jobs:
  list-submodules:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout main repo (no submodules)
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
          submodules: false

      - name: List all submodules recursively
        run: |
          set -euo pipefail

          list_submodules() {
            local repo_path="$1"
            local prefix="$2"

            if [ -f "$repo_path/.gitmodules" ]; then
              echo "üîç Found .gitmodules in $repo_path"

              # Extract submodule paths from .gitmodules
              grep "path =" "$repo_path/.gitmodules" | awk '{print $3}' | while read -r sub_path; do
                local full_path="$prefix$sub_path"
                echo "$full_path"

                # Initialize this submodule only
                git submodule update --init --depth 1 -- "$sub_path"

                # Recurse into this submodule
                list_submodules "$sub_path" "$full_path/"
              done
            fi
          }

          echo "üìã Listing all submodules:"
          list_submodules "." "main/"
